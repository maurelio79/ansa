<!DOCTYPE html> 

<html lang="it-IT">
    <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <meta name="DESCRIPTION" content="">
    <title>Ansa Grabber</title>
    
    <meta name="viewport" content="width=device-width, initial-scale=1"> 
    
    <link rel="stylesheet" href="css/jquery.mobile-1.3.2.min.css" />
    <link rel="stylesheet" href="css/ansa.min.css" />
    <link rel="stylesheet" href="css/style.css" />
    <script type="text/javascript" src="js/jquery-1.10.2.min.js"></script>
    <script src="js/jquery.mobile-1.3.2.min.js"></script>
	<script type="text/javascript" charset="utf-8" src="cordova.js"></script>
	<script type="text/javascript" charset="utf-8">
	document.addEventListener("deviceready", onDeviceReady, false);

	function querySuccess(tx, results) {
					alert("Stampo tutto");
					var len = results.rows.length;
		//		    console.log("DEMO table: " + len + " rows found.");
					for (var i=0; i<len; i++){
		//				alert("Row = " + i + " ID = " + results.rows.item(i).id + " Data =  " + results.rows.item(i).data);
						var category = results.rows.item(i).category;
						var status = results.rows.item(i).status;
						var id = results.rows.item(i).idTag;
					$('#category-list').html("<li><a href='news.html' data-ajax='false' id=" + idTag + "><img src='css/images/icon.jpg' width='80' height='80'><h3>" + category + "</h3></a></li>");
					}
				}

	function errorCB(err) {
		    alert("Error processing SQL: "+err.code);
		}

	function successCB() {
						alert("Setto var e lancio query");
		window.localStorage.setItem("preference", "custom");
		var db = window.openDatabase("Ansa", "1.0", "Ansa Grabber", 200000);
		db.transaction(queryDB, errorCB);
	}

	function queryDB(tx) {
				alert("Lancio query");
		tx.executeSql('SELECT category, status, idTag FROM PREFERENCE WHERE status="active"', [], querySuccess, errorCB);
	}

	function populateDB(tx) {
				alert("Popolo il DB");
		    tx.executeSql('DROP TABLE IF EXISTS PREFERNCE');
		    tx.executeSql('CREATE TABLE IF NOT EXISTS PREFERENCE (id unique, category, status, idTag)');
		    tx.executeSql('INSERT INTO PREFERENCE (id, category, status, idTag) VALUES (1, "Top News", "active", "home")');
		    tx.executeSql('INSERT INTO PREFERENCE (id, category, status, idTag) VALUES (2, "Cronoca",  "active", "cronaca")');
		    tx.executeSql('INSERT INTO PREFERENCE (id, category, status, idTag) VALUES (3, "Economia",  "inactive", economia)');
		    tx.executeSql('INSERT INTO PREFERENCE (id, category, status, idTag) VALUES (4, "Politica",  "inactive", "politica")');
		    tx.executeSql('INSERT INTO PREFERENCE (id, category, status, idTag) VALUES (5, "Scienza",  "active", "scienza")');
		    tx.executeSql('INSERT INTO PREFERENCE (id, category, status, idTag) VALUES (6, "Tecnologia", "active", "tech")');
		    tx.executeSql('INSERT INTO PREFERENCE (id, category, status, idTag) VALUES (7, "Cinema",  "inactive", "cinema")');
		    tx.executeSql('INSERT INTO PREFERENCE (id, category, status, idTag) VALUES (8, "Mondo", "active", "mondo")');
		}

	function onDeviceReady() {
				alert("Il device Ã¨ pronto");
				var db = window.openDatabase("Ansa", "1.0", "Ansa Grabber", 200000);
				if (window.localStorage.getItem("preference") == null) {
				//App runs for first time
				alert("Firsst run");
					db.transaction(populateDB, errorCB, successCB);
				} else {
				//App already runs one time
				alert("Second run");
					db.transaction(queryDB, errorCB, successCB);
				}
			}

	</script>
    
    </head>  
<body>
    <div data-role="page" data-theme="f" id="indexpage">
    <script>
    $( "#indexpage").on('pageinit',function(event){
		$("a").bind( "click", function(event, ui) {
			pos = $(this).attr("id");
			window.sessionStorage.setItem("feed", pos);
		});
    });
    </script>
        <div data-role="header" data-position="fixed"  data-theme="f" id="myHeader">
		<a href="index.html"  class="my-button-home" data-inline="true" data-iconpos="notext" data-theme="a"  data-corners="false" class="ui-btn-left" data-ajax="false"></a>
        <h1>Ansa Grabber</h1>
		<a href="preferenze.html" class="my-button-preference"  data-inline="true" data-iconpos="notext" data-theme="a"  data-corners="false" class="ui-btn-right" data-ajax="false"></a>

        </div>
        <!-- Div tag for stories results -->  
        <div  data-role="content" id="risultato"   data-theme="f">

        <!-- The YQL statment will be assigned to src. -->
		    <ul data-role="listview" data-theme="f" id="category-list">
		    <!--<li><a href="news.html" data-ajax="false" id="home"><img src="css/images/icon.jpg" width="80" height="80" /><h3>Top News</h3></a></li>
		    <li><a href="news.html" data-ajax="false" id="cronaca"><img src="css/images/icon.jpg" width="80" height="80" /><h3>Cronaca</h3></a></li>
		    <li><a href="news.html" data-ajax="false" id="economia"><img src="css/images/icon.jpg" width="80" height="80" /><h3>Economia</h3></a></li>
		    <li><a href="news.html" data-ajax="false" id="politica"><img src="css/images/icon.jpg" width="80" height="80" /><h3>Politica</h3></a></li>
			<li><a href="news.html" data-ajax="false" id="scienza"><img src="css/images/icon.jpg" width="80" height="80" /><h3>Scienza</h3></a></li>
		    <li><a href="news.html" data-ajax="false" id="tech"><img src="css/images/icon.jpg" width="80" height="80" /><h3>Tecnologia</h3></a></li>
		    <li><a href="news.html" data-ajax="false" id="cinema"><img src="css/images/icon.jpg" width="80" height="80" /><h3>Cinema</h3></a></li>
		    <li><a href="news.html" data-ajax="false" id="mondo"><img src="css/images/icon.jpg" width="80" height="80" /><h3>Mondo</h3></a></li>-->
		    </ul>
        </div>
        <div data-role="footer" data-position="fixed"  data-theme="f">
        </div>
    </div>
</body>
</html>  
